<!DOCTYPE html>
<html>

<head>
    <title>Read Text File</title>
</head>

<body>
    <input type="file" name="inputfile" id="inputfile">

    <div id="output"></div>

    <script type="text/javascript">
        document.getElementById('inputfile')
            .addEventListener('change', function () {

                var fr = new FileReader();
                fr.onload = function () {
                    document.getElementById('output')
                        .textContent = fr.result;
                }
                fr.readAsText(this.files[0]);
            })

        var a = `
        [{
    "purchaseHistory": {
      "invoicePrice": "£3.79",
      "paymentMethodTitle": "Mastercard-0000",
      "userLanguageCode": "en_GB",
      "userCountry": "GB",
      "doc": {
        "documentType": "In App Item",
        "title": "1000 Stars (Solitaire Cat Islands-TriPeaks)"
      },
      "purchaseTime": "2022-02-04T05:25:19.112Z"
    }
  },
  {
    "purchaseHistory": {
      "invoicePrice": "£1.59",
      "paymentMethodTitle": "Mastercard-0000",
      "userLanguageCode": "en_GB",
      "userCountry": "GB",
      "doc": {
        "documentType": "In App Item",
        "title": "Skip Ticket x35 (Solitaire Cat Islands-TriPeaks)"
      },
      "purchaseTime": "2022-02-01T06:04:48.646Z"
    }
  },

  {
  "purchaseHistory": {
    "invoicePrice": "£0.00",
    "paymentMethodTitle": "",
    "userLanguageCode": "en_GB",
    "userCountry": "GB",
    "doc": {
      "documentType": "Android Apps",
      "title": "com.rmg.fishclickers.pro"
    },
    "purchaseTime": "2019-11-10T12:00:33.811Z"
  }
},
{
  "purchaseHistory": {
    "invoicePrice": "£0.00",
    "paymentMethodTitle": "",
    "userLanguageCode": "en_GB",
    "userCountry": "GB",
    "doc": {
      "documentType": "Android Apps",
      "title": "com.scv.idle.pro.miner.dig"
    },
    "purchaseTime": "2019-11-10T11:59:31.229Z"
  }
},
{
  "purchaseHistory": {
    "invoicePrice": "£0.99",
    "paymentMethodTitle": "Mastercard-1234",
    "userLanguageCode": "en_GB",
    "userCountry": "GB",
    "doc": {
      "documentType": "In App Item",
      "title": "Starter Pack (Penguin Isle)"
    },
    "purchaseTime": "2019-11-02T10:22:00.286Z"
  }
},
  
  {
    "purchaseHistory": {
      "invoicePrice": "£4.29",
      "paymentMethodTitle": "Mastercard-0000",
      "userLanguageCode": "en_GB",
      "userCountry": "GB",
      "doc": {
        "documentType": "Purchase",
        "title": "Ads Grinder (Wildlife Incremental Idle Game)"
      },
      "purchaseTime": "2021-12-06T01:25:26.030Z"
    }
  }]
  `
        var purchases = JSON.parse(a);
        var summary = purchases.reduce((totals, purchase) => {
            var amount = Number(purchase.purchaseHistory.invoicePrice.replace(/[^0-9.-]+/g, ""));
            if (amount == 0) {
                return totals;
            }

            var type = purchase.purchaseHistory.doc.documentType;
            updateTotals(totals, 'Grouped by purchase type', type, amount);

            var year = new Date(purchase.purchaseHistory.purchaseTime).getFullYear();
            updateTotals(totals, 'Grouped by year', year, amount);

            var appName = purchase.purchaseHistory.doc.title.match(/\(([^)]*)\)[^(]*$/);
            var safeAppName = appName ? appName[1] : purchase.purchaseHistory.doc.title;
            updateTotals(totals, 'Grouped by app', safeAppName, amount);

            var paymentType = purchase.purchaseHistory.paymentMethodTitle;
            updateTotals(totals, 'Grouped by payment method', paymentType, amount);
            return totals;
        }, {});

        var output = document.getElementById('output');
        for (grouping in summary) {
            var newHTML = '<h2>' + grouping + '</h2>\n';
            newHTML += '<table><tr><th></th><th>Count</th><th>Total</th></tr>\n';
            for (type in summary[grouping]) {
                newHTML += '<tr><td><b>' + type + '</b></td>\n';
                newHTML += '<td>' + summary[grouping][type]['count'] + '</td>\n';
                newHTML += '<td>' + summary[grouping][type]['sum'] + '</td></tr>\n';
            }
            newHTML += '</table><br><br>\n';
            output.innerHTML += newHTML;
        }

        function updateTotals(totals, fieldName, fieldValue, purchaseAmount) {
            if (!totals.hasOwnProperty(fieldName)) {
                totals[fieldName] = {}
            }
            if (!totals[fieldName].hasOwnProperty(fieldValue)) {
                totals[fieldName][fieldValue] = {}
                totals[fieldName][fieldValue]['count'] = 0;
                totals[fieldName][fieldValue]['sum'] = 0
            }
            totals[fieldName][fieldValue]['count']++;
            totals[fieldName][fieldValue]['sum'] += purchaseAmount
        }
        console.log(summary);
        console.log(output.innerHTML);
    </script>
</body>

</html>